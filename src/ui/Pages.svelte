<script lang="ts">
  import Checkbox, { CheckboxChangeEvent } from '@components/Checkbox.svelte';
  import Button from '@components/Button.svelte';
  import ButtonFooter from '@components/ButtonFooter.svelte';
  import PageLayout from '@components/PageLayout.svelte';
  import Sidebar from '@components/Sidebar.svelte';
  import Content from '@components/Content.svelte';
  import { pages } from '@stores/pages';
  import { RoutePages, routes } from '@stores/routes';
  import { exportPageIds } from '@stores/exportPages';
  import { MessageTypes, PluginMessage } from '@constants'; 
  import Title from '@components/Title.svelte';
  import './base.css';

  pages.getPages();
  
  const click = (event: CheckboxChangeEvent) => {
    exportPageIds.togglePage(event.detail.value);
  };

  const prepareExport = () => {
    parent.postMessage<PluginMessage<MessageTypes.PrepareExport>>(
      {
        pluginMessage: {
          type: MessageTypes.PrepareExport,
          data: $exportPageIds,
        },
      },
      '*'
    );

    routes.setPage(RoutePages.DownloadList);
  };

  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
  $: showButton = $exportPageIds.length > 0;

</script>


<PageLayout class="pages-page">
  <Title>Select the pages you want to export</Title>
  <Content class="columns">
    {#each $pages as { id, name }}
      <Checkbox         
        value={id}
        id={id}
        name="pages"
        selected={$exportPageIds.includes(id)}
        on:change={click}
      >{name}</Checkbox>
    {/each}
  </Content>
  <Sidebar class="sidebar">
    <Title>Select the pages</Title>
    <ol>
      <li>Select the pages you want all separate images from to be created</li>
      <li>Click the 'Prepare the selection' button. All data wil be prepared.</li>
      <li>The next page will give you an overview of all the images to be created</li>
      <li>From there you can start the actual creation of all the images</li>
      <li>All images are contained in a zipp file</li>
    </ol>
  </Sidebar>
  <ButtonFooter>
    <Button onClick={exportPageIds.clearSelection} disabled={!showButton}>Clear selection</Button>
    <Button onClick={prepareExport} disabled={!showButton}>Prepare the selection</Button>
  </ButtonFooter>
</PageLayout>

<style lang="postcss">
  :global(.pages-page .sidebar) {
    background-repeat:no-repeat;
    background-position: bottom 1rem center;
    background-size: 80%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 579 702' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M57.3896 702C47.5677 702.016 37.9826 696.641 29.9433 686.61C21.9041 676.579 15.8027 662.381 12.4727 645.955C-2.15805 573.501 -15.0481 439.286 42.2357 294.113C105.576 133.593 159.527 21.1017 248.654 4.10636C388.276 -22.5156 403.496 210.591 462.737 287.061C514.573 353.97 568.515 426.204 578.76 608.559C579.428 620.367 578.696 632.294 576.612 643.568C574.529 654.843 571.139 665.217 566.662 674.02C562.184 682.824 556.719 689.862 550.618 694.681C544.517 699.499 537.916 701.992 531.24 701.998L57.3896 702Z' fill='%23F3F5FD'/%3E%3Cpath d='M158.369 47.9V64H84.5319C76.7075 64.0003 69.2035 67.1082 63.6701 72.6402C58.1367 78.1723 55.027 85.6756 55.0249 93.5V621.508C55.0249 629.334 58.1337 636.839 63.6673 642.373C69.2009 647.906 76.7062 651.015 84.5319 651.015H478.72C482.595 651.016 486.432 650.253 490.013 648.771C493.593 647.288 496.846 645.115 499.587 642.375C502.327 639.634 504.5 636.381 505.983 632.801C507.465 629.221 508.228 625.383 508.227 621.508V93.5C508.225 85.6754 505.116 78.1718 499.582 72.6396C494.049 67.1075 486.544 63.9997 478.72 64H404.882V47.9C404.883 45.1704 404.346 42.4674 403.301 39.9454C402.257 37.4234 400.727 35.1317 398.797 33.2013C396.867 31.2709 394.576 29.7396 392.054 28.6948C389.532 27.65 386.829 27.1121 384.1 27.112H179.152C176.422 27.1121 173.719 27.65 171.198 28.6948C168.676 29.7396 166.385 31.2709 164.455 33.2013C162.525 35.1316 160.994 37.4233 159.95 39.9453C158.906 42.4673 158.368 45.1704 158.369 47.9V47.9Z' fill='%23C1D8ED'/%3E%3Cpath d='M82.3149 101.876L82.3149 613.133C82.3149 620.468 88.261 626.414 95.5959 626.414H467.654C474.989 626.414 480.935 620.468 480.935 613.133L480.935 101.876C480.935 94.5411 474.989 88.595 467.654 88.595H95.5959C88.261 88.595 82.3149 94.5411 82.3149 101.876Z' fill='%23FAFAFA'/%3E%3Cpath d='M184.807 64.892V112.3C184.807 117.287 188.85 121.33 193.837 121.33L369.415 121.33C374.402 121.33 378.445 117.287 378.445 112.3V64.892C378.445 59.9049 374.402 55.862 369.415 55.862L193.837 55.862C188.85 55.862 184.807 59.9049 184.807 64.892Z' fill='%230CBC8B'/%3E%3Cpath d='M177.821 353.505H126.4C121.168 353.499 116.151 351.418 112.452 347.718C108.752 344.019 106.671 339.002 106.665 333.77V282.352C106.671 277.12 108.752 272.103 112.452 268.404C116.151 264.704 121.168 262.623 126.4 262.617H177.818C183.05 262.623 188.067 264.704 191.766 268.404C195.466 272.103 197.547 277.12 197.553 282.352V333.77C197.547 339.002 195.467 344.018 191.767 347.717C188.068 351.417 183.053 353.498 177.821 353.505ZM126.4 272.617C123.819 272.62 121.345 273.646 119.52 275.472C117.695 277.297 116.668 279.771 116.665 282.352V333.77C116.668 336.351 117.695 338.825 119.52 340.65C121.345 342.476 123.819 343.502 126.4 343.505H177.818C180.399 343.502 182.873 342.476 184.698 340.65C186.524 338.825 187.55 336.351 187.553 333.77V282.352C187.55 279.771 186.524 277.297 184.698 275.472C182.873 273.646 180.399 272.62 177.818 272.617H126.4Z' fill='%23DEE8F5'/%3E%3Cpath d='M177.156 237.888H125.735C120.503 237.882 115.486 235.801 111.787 232.101C108.087 228.402 106.006 223.385 106 218.153V166.735C106.006 161.503 108.087 156.486 111.787 152.787C115.486 149.087 120.503 147.006 125.735 147H177.153C182.385 147.006 187.402 149.087 191.101 152.787C194.801 156.486 196.882 161.503 196.888 166.735V218.153C196.882 223.385 194.802 228.401 191.102 232.1C187.403 235.8 182.388 237.881 177.156 237.888ZM125.735 157C123.154 157.003 120.68 158.029 118.855 159.855C117.029 161.68 116.003 164.154 116 166.735V218.153C116.003 220.734 117.029 223.208 118.855 225.033C120.68 226.859 123.154 227.885 125.735 227.888H177.153C179.734 227.885 182.208 226.859 184.033 225.033C185.858 223.208 186.885 220.734 186.888 218.153V166.735C186.885 164.154 185.858 161.68 184.033 159.855C182.208 158.029 179.734 157.003 177.153 157H125.735Z' fill='%23DEE8F5'/%3E%3Cpath d='M177.821 469H126.4C121.168 468.994 116.151 466.913 112.452 463.213C108.752 459.514 106.671 454.497 106.665 449.265V397.851C106.671 392.619 108.752 387.602 112.452 383.903C116.151 380.203 121.168 378.122 126.4 378.116H177.818C183.05 378.122 188.067 380.203 191.766 383.903C195.466 387.602 197.547 392.619 197.553 397.851V449.269C197.546 454.5 195.465 459.515 191.766 463.214C188.067 466.913 183.052 468.993 177.821 469V469ZM126.4 388.116C123.819 388.119 121.345 389.145 119.52 390.971C117.695 392.796 116.668 395.27 116.665 397.851V449.269C116.669 451.849 117.696 454.323 119.521 456.147C121.346 457.971 123.82 458.997 126.4 459H177.818C180.399 458.997 182.873 457.971 184.698 456.145C186.524 454.32 187.55 451.846 187.553 449.265V397.851C187.55 395.27 186.524 392.796 184.698 390.971C182.873 389.145 180.399 388.119 177.818 388.116H126.4Z' fill='%23DEE8F5'/%3E%3Cpath d='M177.821 584.5H126.4C121.168 584.494 116.151 582.413 112.452 578.713C108.752 575.013 106.671 569.996 106.665 564.764V513.35C106.671 508.118 108.752 503.101 112.452 499.402C116.151 495.702 121.168 493.621 126.4 493.615H177.818C183.05 493.621 188.067 495.702 191.766 499.402C195.466 503.101 197.547 508.118 197.553 513.35V564.768C197.546 569.999 195.465 575.014 191.766 578.713C188.067 582.412 183.052 584.493 177.821 584.5V584.5ZM126.4 503.615C123.819 503.618 121.345 504.645 119.52 506.47C117.695 508.295 116.668 510.769 116.665 513.35V564.768C116.669 567.348 117.696 569.822 119.521 571.646C121.346 573.471 123.82 574.497 126.4 574.5H177.818C180.399 574.497 182.874 573.47 184.699 571.645C186.524 569.82 187.55 567.345 187.553 564.764V513.35C187.55 510.769 186.524 508.295 184.698 506.47C182.873 504.645 180.399 503.618 177.818 503.615H126.4Z' fill='%23DEE8F5'/%3E%3Cpath d='M141.39 327.9C140.748 327.901 140.114 327.765 139.529 327.501C138.944 327.236 138.423 326.85 138 326.367L122.74 308.92C121.991 308.017 121.624 306.857 121.718 305.687C121.811 304.517 122.358 303.43 123.242 302.658C124.126 301.886 125.276 301.489 126.448 301.553C127.62 301.617 128.72 302.136 129.515 303L141.878 317.134L175.21 289.271C175.66 288.871 176.186 288.565 176.757 288.372C177.327 288.178 177.931 288.102 178.531 288.146C179.132 288.19 179.718 288.355 180.254 288.63C180.79 288.905 181.265 289.284 181.652 289.746C182.038 290.208 182.328 290.743 182.504 291.32C182.68 291.896 182.738 292.501 182.676 293.1C182.614 293.7 182.431 294.28 182.14 294.808C181.849 295.335 181.455 295.799 180.982 296.171L144.275 326.857C143.466 327.533 142.444 327.902 141.39 327.9V327.9Z' fill='%23FD5D76'/%3E%3Cpath d='M140.725 212.283C140.083 212.284 139.449 212.148 138.864 211.884C138.279 211.619 137.758 211.233 137.335 210.75L122.075 193.303C121.326 192.4 120.959 191.24 121.053 190.07C121.146 188.9 121.693 187.813 122.577 187.041C123.461 186.269 124.611 185.872 125.783 185.936C126.955 186 128.055 186.519 128.85 187.383L141.213 201.517L174.545 173.654C174.995 173.254 175.521 172.948 176.092 172.755C176.662 172.561 177.266 172.485 177.866 172.529C178.467 172.573 179.053 172.738 179.589 173.013C180.125 173.288 180.6 173.667 180.987 174.129C181.373 174.591 181.663 175.126 181.839 175.703C182.015 176.279 182.073 176.884 182.011 177.483C181.948 178.083 181.766 178.663 181.475 179.191C181.184 179.718 180.79 180.182 180.317 180.554L143.61 211.24C142.801 211.916 141.779 212.285 140.725 212.283V212.283Z' fill='%23FD5D76'/%3E%3Cpath d='M141.39 558.9C140.748 558.901 140.113 558.765 139.528 558.5C138.944 558.235 138.422 557.848 138 557.365L122.74 539.919C122.351 539.474 122.053 538.957 121.864 538.397C121.675 537.837 121.598 537.246 121.637 536.656C121.676 536.066 121.832 535.49 122.094 534.96C122.356 534.431 122.72 533.958 123.164 533.568C123.609 533.179 124.126 532.882 124.686 532.692C125.246 532.503 125.838 532.426 126.428 532.466C127.017 532.505 127.593 532.66 128.123 532.922C128.653 533.184 129.126 533.548 129.515 533.993L141.878 548.128L175.21 520.264C175.66 519.864 176.186 519.558 176.757 519.365C177.327 519.171 177.931 519.095 178.531 519.139C179.132 519.183 179.718 519.348 180.254 519.623C180.79 519.898 181.265 520.277 181.652 520.739C182.038 521.201 182.328 521.736 182.504 522.313C182.68 522.889 182.738 523.494 182.676 524.093C182.614 524.693 182.431 525.273 182.14 525.801C181.849 526.328 181.455 526.792 180.982 527.164L144.275 557.849C143.467 558.528 142.445 558.9 141.39 558.9V558.9Z' fill='%23FD5D76'/%3E%3Cg opacity='0.62'%3E%3Cpath opacity='0.62' d='M225.372 302.068C222.062 302.068 219.378 304.751 219.378 308.062C219.378 311.372 222.062 314.055 225.372 314.055H450.439C453.749 314.055 456.433 311.372 456.433 308.062C456.433 304.751 453.749 302.068 450.439 302.068H225.372Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 265.326C222.061 265.326 219.377 268.009 219.377 271.32C219.377 274.63 222.061 277.313 225.371 277.313H450.438C453.748 277.313 456.432 274.63 456.432 271.32C456.432 268.009 453.748 265.326 450.438 265.326H225.371Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 338.81C222.061 338.81 219.377 341.493 219.377 344.804C219.377 348.114 222.061 350.797 225.371 350.797H400.438C403.748 350.797 406.432 348.114 406.432 344.804C406.432 341.493 403.748 338.81 400.438 338.81H225.371Z' fill='%23DEE8F5'/%3E%3C/g%3E%3Cg opacity='0.62'%3E%3Cpath opacity='0.62' d='M224.707 186.451C221.396 186.451 218.713 189.134 218.713 192.445C218.713 195.755 221.396 198.438 224.707 198.438H449.774C453.084 198.438 455.768 195.755 455.768 192.445C455.768 189.134 453.084 186.451 449.774 186.451H224.707Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M224.706 149.709C221.396 149.709 218.712 152.392 218.712 155.703C218.712 159.013 221.396 161.696 224.706 161.696H449.773C453.083 161.696 455.767 159.013 455.767 155.703C455.767 152.392 453.083 149.709 449.773 149.709H224.706Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M224.706 223.193C221.396 223.193 218.712 225.876 218.712 229.187C218.712 232.497 221.396 235.18 224.706 235.18H399.773C403.083 235.18 405.767 232.497 405.767 229.187C405.767 225.876 403.083 223.193 399.773 223.193H224.706Z' fill='%23DEE8F5'/%3E%3C/g%3E%3Cg opacity='0.62'%3E%3Cpath opacity='0.62' d='M225.372 417.567C222.062 417.567 219.378 420.25 219.378 423.561C219.378 426.871 222.062 429.554 225.372 429.554H450.439C453.749 429.554 456.433 426.871 456.433 423.561C456.433 420.25 453.749 417.567 450.439 417.567H225.372Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 380.825C222.061 380.825 219.377 383.508 219.377 386.819C219.377 390.129 222.061 392.812 225.371 392.812H450.438C453.748 392.812 456.432 390.129 456.432 386.819C456.432 383.508 453.748 380.825 450.438 380.825H225.371Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 454.309C222.061 454.309 219.377 456.992 219.377 460.303C219.377 463.613 222.061 466.296 225.371 466.296H400.438C403.748 466.296 406.432 463.613 406.432 460.303C406.432 456.992 403.748 454.309 400.438 454.309H225.371Z' fill='%23DEE8F5'/%3E%3C/g%3E%3Cg opacity='0.62'%3E%3Cpath opacity='0.62' d='M225.372 533.066C222.062 533.066 219.378 535.749 219.378 539.06C219.378 542.37 222.062 545.053 225.372 545.053H450.439C453.749 545.053 456.433 542.37 456.433 539.06C456.433 535.749 453.749 533.066 450.439 533.066H225.372Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 496.324C222.061 496.324 219.377 499.007 219.377 502.318C219.377 505.628 222.061 508.311 225.371 508.311H450.438C453.748 508.311 456.432 505.628 456.432 502.318C456.432 499.007 453.748 496.324 450.438 496.324H225.371Z' fill='%23DEE8F5'/%3E%3Cpath opacity='0.62' d='M225.371 569.808C222.061 569.808 219.377 572.491 219.377 575.802C219.377 579.112 222.061 581.795 225.371 581.795H400.438C403.748 581.795 406.432 579.112 406.432 575.802C406.432 572.491 403.748 569.808 400.438 569.808H225.371Z' fill='%23DEE8F5'/%3E%3C/g%3E%3C/svg%3E")
  }
</style>
